- name: wait bootstrap node
  hosts: 127.0.0.1
  tags:
    - others
  tasks:
    - name: wait until bootstrap node ends all the tasks
      uri:
        url: "http://{{ lookup('env','consul') }}:{{ lookup('env','consul_port') }}/v1/kv/kubernetes/{{ lookup('env','cluster_name') }}/custom_bootstrap_end"
        method: GET
        status_code: 200
        body: '{ "name": {{ ansible_hostname }}.node.{{ lookup("env","consul_datacenter") }}.consul }'
      register: bootstrap_wait
      until: bootstrap_wait.failed == false
      delay: 1
      retries: 6000
